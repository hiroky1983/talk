services:
  # Go backend server
  app:
    build:
      context: .
      dockerfile: ./go/Dockerfile
    ports:
      - "8000:8000"
      - "2349:2349" # .air.toml と launch.json のDelveポートに合わせる
    volumes:
      # ホストの ./go ディレクトリをコンテナの /app にマウントしてホットリロードを有効化
      - ./go:/app
    depends_on:
      - ai-service
    environment:
      - AI_SERVICE_HOST=ai-service
      - AI_SERVICE_PORT=50051
      
  # Python AI service
  ai-service:
    build:
      context: ./python
      dockerfile: Dockerfile
    ports:
      - "50051:50051"
    volumes:
      - ./python:/app
      - ./python/.env:/app/.env
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
