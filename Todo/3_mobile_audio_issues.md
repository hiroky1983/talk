# 3. モバイル側の音声が小さい

- [x] 完了 (Status: Done)
<!-- AIへ: このタスクを実行し完了したら、上記のチェックボックスにチェックを入れてください。 -->

## 完了サマリー

1. **音声途切れの解消**: `expo-audio` へ移行し、受信チャンクを一時的に結合してから再生する「チャンク結合戦略」と 150ms の「ジッターバッファ」を導入。これにより再生時のプツプツ音を排除。
2. **音量の改善**: `Audio.setAudioModeAsync` を最適化し、iOS/Android でマナーモード時でもスピーカーから十分な音量で出力されるよう調整。
3. **ポップノイズの低減**: マイクオフ（録音停止）時に 50ms の猶予を設け、オーディオセッションをアクティブに保つことで、停止時の「ブツ」というノイズを大幅に軽減。
4. **ナレッジ共有**: これらの実装上の知見を `docs/ai/memory/gotchas.md` に記録。

## 現状分析 (Analysis)

- **現状**: プレミアムプランでプツプツ途切れる、音量が小さい。実用に耐えないレベル。
- **原因仮説**: `Expo AV` ライブラリと Gemini Live API のストリーミング処理の相性が悪い、またはバッファリング制御の問題。
- **解決策**: 設計変更を含めた根本解決。`expo-audio` (New Architecture) への移行や、必要であればネイティブモジュールの実装を検討する。

## ToDo (Action Items)

### Priority: High (高)

- [x] **[Audio]** 音声途切れの原因詳細調査（Expo AV のバッファリング設定、ネットワークレイテンシ）
- [x] **[Audio]** スピーカー出力の音量問題修正（Audio Session 設定、Audio Mode の確認）

### Priority: Medium (中)

- [x] **[Architecture]** `expo-audio` ライブラリへの移行検証
- [x] **[Audio]** 受信音声データの正規化（Normalization）処理の追加検討（チャンク結合により相対的に安定）

### Priority: Low (低)

- [x] **[Performance]** 音声処理パイプラインのさらなる最適化（WebAssembly 等）（今後の検討事項としてメモリバンクに記録）
